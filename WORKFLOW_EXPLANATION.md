# GitHub Workflows Explanation

## Current Workflow

Your repository has **one workflow** at `.github/workflows/pages.yml`:

```yaml
name: pages-build-deployment

on:
  push:
    branches: ["main"]

permissions:
  contents: read
  pages: write
  id-token: write

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: 20
      - run: npm install --no-audit --no-fund
      - run: npm run build
      - uses: actions/upload-pages-artifact@v3
        with:
          path: dist

  deploy:
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    runs-on: ubuntu-latest
    needs: build
    steps:
      - id: deployment
        uses: actions/deploy-pages@v4
```

## What This Workflow Does

1. **Triggers** on every push to `main` branch
2. **Checks out** your code
3. **Installs** npm dependencies
4. **Builds** the Spark React app (`npm run build` â†’ creates `/dist` folder)
5. **Uploads** the `/dist` folder as a Pages artifact
6. **Deploys** to GitHub Pages

## What Gets Published

- The **Spark application itself** (the React SPA)
- Any **static files in the repository** (including manually committed page folders)

### Example:

If your repo structure is:
```
infinity-spark/
â”œâ”€â”€ src/              # Spark app source
â”œâ”€â”€ dist/             # Built app (auto-generated)
â”œâ”€â”€ Pixie/
â”‚   â””â”€â”€ pages/
â”‚       â””â”€â”€ memory-1/
â”‚           â”œâ”€â”€ index.html    â† Manually committed
â”‚           â””â”€â”€ page.json     â† Manually committed
```

GitHub Pages will serve:
- **Main app**: `https://username.github.io/infinity-spark/` (the Spark interface)
- **Page**: `https://username.github.io/infinity-spark/Pixie/pages/memory-1/` (your manually committed page)

## Why The Workflow You Mentioned Doesn't Work

The workflow you pasted:

```yaml
name: Collect Spark Pages

on:
  workflow_run:
    workflows: ["Spark Preview"]
    types: [completed]

jobs:
  collect:
    steps:
      - name: Download Spark artifact
        uses: actions/download-artifact@v4
        with:
          run-id: ${{ github.event.workflow_run.id }}
```

This workflow:
- **Requires** a "Spark Preview" workflow that doesn't exist
- **Expects** artifacts to be generated by that workflow
- **Is designed** for a different architecture (backend-generated pages)

### Why It's Incompatible:

INFINITY is a **browser-based SPA**. When you "publish" a page:
1. Files are generated in **browser storage** (IndexedDB via Spark KV)
2. They exist only **in your browser**
3. No workflow can access them
4. No artifact is created

The workflow you pasted expects a **server-side build process** that generates page artifacts, which this app doesn't have.

## The Correct Workflow (Already In Place)

The existing `pages.yml` workflow is **exactly what you need**. It:

1. âœ… Builds and deploys the Spark app
2. âœ… Includes any files you manually commit (like page folders)
3. âœ… Runs automatically on every push

## How To Actually Publish Pages

Since the workflow **cannot** access browser storage:

### Manual Process (Current):

1. Generate page in browser (click "Publish")
2. Download files (click "Download Page Files")
3. Create folder structure in repo:
   ```
   <site-name>/pages/<slug>/index.html
   <site-name>/pages/<slug>/page.json
   ```
4. Commit and push:
   ```bash
   git add <site-name>/
   git commit -m "Add page"
   git push
   ```
5. Workflow runs automatically
6. Page is live at `https://username.github.io/repo/<site-name>/pages/<slug>/`

### Why This Is The Only Way:

- âŒ Browser apps cannot write to GitHub repos
- âŒ No backend server to generate artifacts
- âŒ GitHub Actions cannot access browser storage
- âœ… Manual commit is the bridge between browser and repo

## Alternative: Automated Publishing (Would Require Major Changes)

To automate publishing, you would need:

1. **Backend server** to receive page data from browser
2. **GitHub API integration** to create commits
3. **Authentication** to verify users
4. **Workflow** to trigger on backend-generated artifacts

This fundamentally changes the architecture from:
- "Browser-based generator with manual publishing"

To:
- "Full-stack app with authenticated GitHub integration"

That's a complete rebuild, not a workflow fix.

## Summary

### âœ… Keep Current Workflow

The existing `pages.yml` is correct and sufficient.

### âŒ Don't Add "Collect Spark Pages" Workflow

It's incompatible with this architecture.

### ğŸ‘‰ Understand The Reality

- Spark app = deployed automatically by workflow
- Individual pages = must be manually committed
- This is a **feature**, not a bug (you control what gets published)

### ğŸ“– Read The Guide

See [PUBLISHING_GUIDE.md](./PUBLISHING_GUIDE.md) for the complete manual publishing process.

## Questions?

**Q: Why can't the workflow auto-commit pages?**  
A: Because pages are generated in your browser, not in a GitHub Action runner. The workflow has no access to your browser storage.

**Q: Can I make it automatic?**  
A: Only with a complete architectural rewrite (add backend server + GitHub API integration).

**Q: Is this the intended design?**  
A: Yes. Manual publishing gives you control and doesn't require authentication or backend infrastructure.

**Q: Why does it say "Awaiting Build" if I didn't commit files?**  
A: The app generates the HTML and shows the expected URL optimistically. But without committing files, the URL will 404. Click "Download Page Files" to get the files, then commit them.
